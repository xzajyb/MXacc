# MXacc Wiki文档系统

## 🎯 系统概述

MXacc Wiki系统是一个现代化的文档管理平台，**完全保留VitePress的原生前端界面和markdown渲染器**，包括3D模型支持等高级功能。系统实现了前后端分离的架构，后台可动态管理内容，前台使用VitePress原生界面展示。

## ✨ 核心特性

### 🔥 VitePress原生功能保留
- **✅ 完整的VitePress前端界面** - 1:1还原，不重写
- **✅ 原生markdown渲染器** - 支持所有VitePress功能
- **✅ 3D模型支持** - 完整保留VitePress的3D模型展示能力
- **✅ 代码高亮** - 语法高亮和代码块功能
- **✅ 数学公式** - LaTeX数学公式支持
- **✅ 自定义容器** - 提示、警告、危险等容器
- **✅ 搜索功能** - 本地搜索和全文检索
- **✅ 响应式设计** - 桌面端和移动端适配
- **✅ 深浅主题** - 自动主题切换

### 📊 后台管理功能
- **📝 文档管理** - 创建、编辑、删除、发布文档
- **📁 分类管理** - 组织文档分类和层级结构
- **🔍 搜索筛选** - 按分类、状态、关键词筛选
- **📈 统计概览** - 文档数量、发布状态统计
- **🔄 一键重建** - 自动生成VitePress静态文件
- **👥 权限控制** - 仅管理员可管理内容

## 🏗️ 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                    MXacc Wiki 系统架构                      │
├─────────────────────────────────────────────────────────────┤
│  前台展示层 (VitePress原生)                                 │
│  ┌─────────────────────────────────────────────────────────┐│
│  │  • VitePress主题界面                                    ││
│  │  • 原生markdown渲染器                                  ││
│  │  • 3D模型支持                                          ││
│  │  • 搜索、导航、主题切换                                ││
│  └─────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│  管理层 (React管理界面)                                     │
│  ┌─────────────────────────────────────────────────────────┐│
│  │  • WikiPage 组件                                       ││
│  │  • 文档CRUD操作                                        ││
│  │  • 分类管理                                            ││
│  │  • 重建功能                                            ││
│  └─────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│  API层 (Node.js接口)                                       │
│  ┌─────────────────────────────────────────────────────────┐│
│  │  • /api/social/content - Wiki管理API集成              ││
│  │  • JWT权限验证                                         ││
│  │  • MongoDB数据操作                                     ││
│  └─────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│  构建层 (自动化脚本)                                        │
│  ┌─────────────────────────────────────────────────────────┐│
│  │  • scripts/build-wiki.js                               ││
│  │  • MongoDB → VitePress文档转换                         ││
│  │  • 保留所有原生功能配置                                ││
│  └─────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│  数据层 (MongoDB)                                           │
│  ┌─────────────────────────────────────────────────────────┐│
│  │  • wikis - 文档集合                                    ││
│  │  • wiki_categories - 分类集合                          ││
│  │  • 完整的文档元数据                                    ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

## 🚀 功能亮点

### 1. 双重界面体验
- **前台用户**：享受VitePress原生的优美界面和强大功能
- **管理员**：通过现代化的React界面轻松管理内容

### 2. 无缝内容更新
```
管理员编辑文档 → 保存到MongoDB → 一键重建 → VitePress静态文件更新
```

### 3. 完整的3D模型支持
```markdown
# 在文档中直接使用3D模型
<model-viewer src="/models/example.glb" auto-rotate></model-viewer>
```

### 4. 高级Markdown功能
```markdown
::: tip 提示
这是一个提示容器
:::

::: warning 注意
支持多种容器类型
:::

$$
E = mc^2
$$

```javascript
// 完整的代码高亮支持
console.log('Hello VitePress!')
```
```

## 📋 管理功能详解

### 文档管理
- ✅ 创建新文档（支持完整Markdown语法）
- ✅ 编辑现有文档（富文本编辑器）
- ✅ 设置文档分类和排序
- ✅ 发布/草稿状态控制
- ✅ 批量操作和搜索筛选

### 分类管理
- ✅ 创建文档分类
- ✅ 设置分类描述和排序
- ✅ 控制分类可见性
- ✅ 检查分类下文档数量

### 重建功能
- ✅ 一键重建VitePress静态文件
- ✅ 自动更新导航和侧边栏
- ✅ 保留所有VitePress原生配置
- ✅ 实时状态反馈

## 🛠️ 快速开始

### 1. 访问管理界面
管理员登录后，在仪表板中点击"Wiki管理"

### 2. 创建第一个分类
```
分类名称: 用户指南
URL标识符: user-guide
描述: 系统使用指南和教程
```

### 3. 创建第一篇文档
```
标题: 快速开始
URL标识符: quick-start
分类: 用户指南
内容: (支持完整Markdown语法)
```

### 4. 重建并查看
点击"重建Wiki" → 访问 `/docs/` 查看VitePress界面

## 🎨 自定义扩展

### 添加3D模型支持
1. 上传模型文件到 `public/docs/models/`
2. 在文档中使用VitePress的3D组件
3. 自动支持 .gltf, .glb, .fbx 等格式

### 扩展Markdown功能
系统完全保留VitePress的扩展能力：
- Vue组件嵌入
- 自定义容器
- 插件系统
- 主题定制

## 🔒 安全性

- **权限控制**：仅管理员可访问管理界面
- **JWT验证**：API接口安全验证
- **输入验证**：防止XSS和SQL注入
- **文件安全**：上传文件类型限制

## 📈 性能优化

- **静态生成**：VitePress静态文件，访问速度快
- **缓存优化**：MongoDB连接复用
- **懒加载**：图片和组件按需加载
- **代码分割**：优化包体积

## 🔄 更新流程

```
1. 管理员在后台编辑文档
   ↓
2. 内容保存到MongoDB
   ↓  
3. 点击"重建Wiki"按钮
   ↓
4. 系统自动执行 build-wiki.js
   ↓
5. 生成新的VitePress静态文件
   ↓
6. 用户访问最新的文档内容
```

## 🎯 核心优势

1. **保留原生体验** - 完全使用VitePress原生界面，用户体验一致
2. **动态内容管理** - 后台可随时更新内容，无需重新部署
3. **功能完整性** - 支持3D模型、数学公式、代码高亮等所有高级功能
4. **开发友好** - 维护简单，扩展方便
5. **性能优异** - 静态文件访问，速度快，SEO友好

## 📁 API整合优化

**✅ API合并完成！** Wiki管理功能已完全整合到社交API中：

- **统一端点**: `/api/social/content` (使用 `action=wiki` 参数)
- **权限控制**: 管理员专用功能，JWT验证
- **功能完整**: 支持分类和文档的完整CRUD操作
- **重建功能**: 一键生成VitePress静态文件
- **代码优化**: 减少API文件数量，提高维护性

### 使用方式：
```javascript
// 获取分类列表
GET /api/social/content?action=wiki&type=categories

// 获取文档列表  
GET /api/social/content?action=wiki&type=list

// 创建分类
POST /api/social/content
{ action: 'wiki', type: 'create-category', name: '...', slug: '...' }

// 重建Wiki
POST /api/social/content?action=wiki&type=rebuild
```

---

**严禁重写VitePress前端和markdown渲染器！**  
本系统的核心价值在于保留VitePress的所有原生功能，包括3D模型支持等高级特性。 