# 管理员邮件系统和找回密码功能指南

## 📧 系统概述

本系统为管理员提供了强大的邮件发送功能，同时完善了用户的找回密码流程。所有邮件功能都使用LuckyCola第三方邮件API，确保高可靠性和安全性。

## 🔧 新增API端点

### 管理员邮件发送
- **GET** `/api/admin/send-email` - 获取邮件模板列表
- **POST** `/api/admin/send-email` - 发送邮件

### 用户管理
- **GET** `/api/admin/users` - 获取用户列表（支持分页、搜索、过滤）
- **PUT** `/api/admin/users` - 管理用户状态（禁用/启用/验证邮箱/设置管理员）
- **DELETE** `/api/admin/users` - 删除用户

### 找回密码
- **POST** `/api/auth/forgot-password` - 发送密码重置验证码
- **POST** `/api/auth/reset-password` - 验证码重置密码

## 📧 邮件模板系统

### 内置模板

#### 1. 系统通知 (`system_notification`)
- **用途**: 系统重要通知、公告
- **特色**: 蓝紫渐变头部，专业商务风格
- **参数**: `content`, `actionUrl`, `actionText`

#### 2. 安全提醒 (`security_alert`)
- **用途**: 安全警告、异常活动提醒
- **特色**: 红色警告风格，突出安全建议
- **参数**: `content`

#### 3. 欢迎邮件 (`welcome`)
- **用途**: 新用户欢迎、功能介绍
- **特色**: 蓝色渐变头部，温馨欢迎风格
- **参数**: `content`

#### 4. 自定义邮件 (`custom`)
- **用途**: 灵活的自定义内容
- **特色**: 通用模板，支持自定义标题和按钮
- **参数**: `title`, `content`, `actionUrl`, `actionText`

### 模板特色
- ✅ 响应式设计，兼容各种邮件客户端
- ✅ 统一的梦锡工作室品牌风格
- ✅ 专业的HTML邮件格式
- ✅ 自动适应深浅色主题

## 🎯 管理员功能

### 邮件发送功能

#### 收件人选择
1. **发送给所有用户**: 自动筛选已验证邮箱的用户
2. **发送给选中用户**: 从用户列表中选择特定用户
3. **发送给指定邮箱**: 手动输入邮箱地址（每行一个）

#### 发送限制
- ✅ 单次最多发送给100个收件人
- ✅ 发送间隔1秒，避免频率限制
- ✅ 详细的发送结果统计
- ✅ 完整的操作日志记录

### 用户管理功能

#### 用户统计面板
```
总用户 | 已验证 | 未验证 | 管理员 | 已禁用
```

#### 用户操作
- **禁用/启用账户**: 控制用户访问权限
- **验证邮箱**: 手动为用户验证邮箱
- **设置管理员**: 提升用户为管理员权限
- **移除管理员**: 降级管理员为普通用户

#### 安全限制
- ❌ 管理员无法操作自己的账户
- ❌ 无法删除其他管理员账户
- ❌ 所有操作都有详细的日志记录

## 🔐 找回密码功能

### 发送流程
1. 用户输入邮箱地址
2. 系统验证邮箱是否已注册且已验证
3. 发送6位数字验证码到用户邮箱
4. 验证码有效期10分钟

### 安全限制
- ✅ **3分钟内最多发送3次**验证码
- ✅ **每次发送间隔30秒**防止频繁点击
- ✅ 用户独立的发送限制计数
- ✅ 即使用户不存在也返回成功消息（防止邮箱枚举攻击）

### 重置流程
1. 输入6位数字验证码
2. 设置新密码（必须包含大小写字母和数字）
3. 确认新密码
4. 验证成功后自动跳转到登录页面

### 密码要求
- ✅ 最少8位字符
- ✅ 必须包含大写字母
- ✅ 必须包含小写字母
- ✅ 必须包含数字
- ✅ 不能与当前密码相同

## 🚀 页面路由

### 新增路由
```
/admin              - 管理员控制台
/forgot-password    - 找回密码页面
/reset-password     - 重置密码页面（复用找回密码页面）
```

### 管理员页面
- **邮件发送标签页**: 模板选择、收件人配置、内容编辑
- **用户管理标签页**: 用户列表、统计面板、批量操作

## 🎨 邮件样式特色

### 梦锡工作室品牌元素
```html
- 主色调: 梦锡蓝 (#667eea) 到 紫色 (#764ba2) 渐变
- 安全色: 红色 (#ff6b6b) 到 (#ee5a5a) 渐变  
- 欢迎色: 蓝色 (#4facfe) 到 青色 (#00f2fe) 渐变
- 字体: Microsoft YaHei, Arial, sans-serif
- 边框半径: 8px-10px 圆角设计
- 阴影: 0 2px 10px rgba(0,0,0,0.1)
```

### 邮件内容结构
1. **头部区域**: 渐变背景 + 梦锡工作室Logo + MXacc标识
2. **主体内容**: 白色背景 + 结构化内容布局
3. **交互按钮**: 明显的CTA按钮设计
4. **底部信息**: 官方发送标识 + 联系方式

## 📱 前端用户体验

### 找回密码页面特色
- ✅ 分步式界面（发送验证码 → 重置密码）
- ✅ 实时倒计时显示
- ✅ 验证码输入优化（6位数字，自动格式化）
- ✅ 密码强度实时验证
- ✅ 详细的安全提示说明

### 管理员页面特色
- ✅ 现代化标签页设计
- ✅ 用户统计数据可视化
- ✅ 实时搜索和过滤功能
- ✅ 批量操作支持
- ✅ 发送结果实时反馈

## 🔒 安全措施总结

### 邮件发送安全
1. **权限验证**: 只有管理员可以发送系统邮件
2. **频率限制**: 避免邮件服务滥用
3. **日志记录**: 所有操作都有完整的审计日志
4. **错误处理**: 安全的错误信息，不泄露敏感数据

### 找回密码安全
1. **频率限制**: 防止暴力破解和垃圾邮件
2. **验证码过期**: 10分钟自动失效
3. **一次性使用**: 验证码使用后立即失效
4. **隐私保护**: 防止邮箱枚举攻击

### 用户管理安全
1. **权限隔离**: 管理员无法操作自己账户
2. **保护机制**: 无法删除其他管理员
3. **操作日志**: 详细记录所有管理操作
4. **状态同步**: 实时更新用户状态

## 📧 邮件API使用示例

### 发送系统通知
```javascript
POST /api/admin/send-email
Authorization: Bearer <admin_token>

{
  "recipients": "all",
  "template": "system_notification",
  "subject": "系统维护通知",
  "data": {
    "content": "系统将于今晚22:00-24:00进行维护，请提前保存工作内容。",
    "actionUrl": "https://status.mxacc.com",
    "actionText": "查看详情"
  }
}
```

### 发送欢迎邮件
```javascript
POST /api/admin/send-email
Authorization: Bearer <admin_token>

{
  "recipients": "selected",
  "userIds": ["user_id_1", "user_id_2"],
  "template": "welcome",
  "data": {
    "content": "感谢您注册梦锡账号，您现在可以享受我们的所有服务。"
  }
}
```

## 🎯 使用场景

### 管理员邮件发送场景
1. **系统维护通知**: 提前通知用户系统维护时间
2. **安全警告**: 发现异常活动时的安全提醒
3. **功能更新**: 新功能上线的通知邮件
4. **活动推广**: 梦锡工作室活动或服务推广

### 找回密码使用场景
1. **忘记密码**: 用户无法记住登录密码
2. **安全重置**: 怀疑账户被盗时主动重置
3. **定期更换**: 定期更换密码提高安全性

## 🎉 总结

本次更新实现了一个功能完整、安全可靠的管理员邮件系统和找回密码功能：

✅ **4个精美的邮件模板**，支持梦锡工作室品牌风格
✅ **完善的管理员控制台**，支持用户管理和邮件发送
✅ **安全的找回密码流程**，包含频率限制和验证机制
✅ **现代化的用户界面**，提供优秀的用户体验
✅ **企业级的安全措施**，保护系统和用户数据安全

系统现在具备了企业级邮件管理能力，可以满足梦锡工作室的各种业务需求。 